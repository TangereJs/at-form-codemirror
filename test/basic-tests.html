<!doctype html>
<html>

<head>

  <title>at-form-text tests</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../iron-test-helpers/test-helpers.js"></script>
  <script src="../../iron-test-helpers/mock-interactions.js"></script>

  <link rel="import" href="../at-form-codemirror.html">

</head>

<body>

  <test-fixture id="isLabelDisplayed">
    <template>
      <at-form-codemirror label="lorem ipsum"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isLabelHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" hide-label></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isLabelHiddenV2">
    <template>
      <at-form-codemirror label="lorem ipsum" hide-label=false></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isLabelHiddenV3">
    <template>
      <at-form-codemirror label="lorem ipsum" hide-label="false"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementDisabled">
    <template>
      <at-form-codemirror label="lorem ipsum" disabled></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" hide></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementDisabledAndHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" disabled hide></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValid">
    <template>
      <at-form-codemirror></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementInvalidWhenRequired">
    <template>
      <at-form-codemirror required></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValidWhenRequiredAndDisabled">
    <template>
      <at-form-codemirror label="lorem ipsum" required disabled></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValidWhenRequiredAndHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" required hide></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValidWhenRequiredDisabledAndHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" required disabled hide></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementInvalidWhenErrorMessage">
    <template>
      <at-form-codemirror label="lorem ipsum" error-message="lorem ipsum"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValidWhenErrorMessageAndDisabled">
    <template>
      <at-form-codemirror label="lorem ipsum" error-message="lorem ipsum" disabled></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValidWhenErrorMessageAndHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" error-message="lorem ipsum" hide></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isElementValidWhenErrorMessageDisabledAndHidden">
    <template>
      <at-form-codemirror label="lorem ipsum" error-message="lorem ipsum" disabled hide></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="maxChars0EmptyValue">
    <template>
      <at-form-codemirror></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="maxChars10EmptyValue">
    <template>
      <at-form-codemirror max-chars="10"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="maxChars0ValueLoremIpsum">
    <template>
      <at-form-codemirror value="lorem ipsum"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="maxChars10ValueLoremIpsum">
    <template>
      <at-form-codemirror max-chars="10" value="lorem ipsum"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="isHintDisplayed">
    <template>
      <at-form-codemirror hint="This is demo hint"></at-form-codemirror>
    </template>
  </test-fixture>

  <test-fixture id="propertyTest">
    <template>
      <at-form-codemirror></at-form-codemirror>
    </template>
  </test-fixture>


  <script>
    suite('basic tests', function() {

      suite('property values are set as attributes', function() {

        test('is label displayed', function() {
          var element = fixture('isLabelDisplayed');
          assert.equal('lorem ipsum', element.label, "element's label not set correctly");
          var label = element.$.label;
          assert.notEqual(null, label, "element's label doesn't exist");
          var displayValue = label.getComputedStyleValue('display');
          assert.equal('block', displayValue, "element's label is not visible");
          assert.equal('lorem ipsum', Polymer.dom(label).innerHTML, "element's label value not set correctly");
        });

        test('is label hidden, hide label attribute present', function() {
          var element = fixture('isLabelHidden');
          assert.equal('lorem ipsum', element.label, "element's label not set correctly");
          assert.equal(true, element.hideLabel, "hideLabel has incorrect value");

          var label = element.$.label;
          assert.notEqual(null, label, "element's label doesn't exist");
          var displayValue = label.getComputedStyleValue('display');
          assert.equal('none', displayValue, "element's label is not visible");
          assert.equal('lorem ipsum', Polymer.dom(label).innerHTML, "element's label value not set correctly");
        });

        test('is label hidden hide-label=false', function() {
          var element = fixture('isLabelHiddenV2');
          assert.equal('lorem ipsum', element.label, "element's label not set correctly");
          assert.equal(true, element.hideLabel, "hideLabel has incorrect value");

          var label = element.$.label;
          assert.notEqual(null, label, "element's label doesn't exist");
          var displayValue = label.getComputedStyleValue('display');
          assert.equal('none', displayValue, "element's label is not visible");
          assert.equal('lorem ipsum', Polymer.dom(label).innerHTML, "element's label value not set correctly");
        });

        test('is label hidden hide-label="false"', function() {
          var element = fixture('isLabelHiddenV3');
          assert.equal('lorem ipsum', element.label, "element's label not set correctly");
          assert.equal(true, element.hideLabel, "hideLabel has incorrect value");

          var label = element.$.label;
          assert.notEqual(null, label, "element's label doesn't exist");
          var displayValue = label.getComputedStyleValue('display');
          assert.equal('none', displayValue, "element's label is not visible");
          assert.equal('lorem ipsum', Polymer.dom(label).innerHTML, "element's label value not set correctly");
        });

        test('is element disabled', function () {
          var element = fixture('isElementDisabled');
          assert.equal(true, element.disabled, "element is not disabled");

          var label = element.$.label;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "label doesn't have disabled class");

          var cc = element.$.contentContainer;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "contentContainer doesn't have disabled class");

        });

        test('is element hidden', function () {
          var element = fixture('isElementHidden');
          assert.equal(true, element.hide, "element is not hidden");

          var atContainer = element.$.atContainer;
          assert.equal(true, Polymer.dom(atContainer).classList.contains('hidden'), "atContainer doesn't have hidden class");
        });

        test('is element disabled and hidden', function () {
          var element = fixture('isElementDisabledAndHidden');
          assert.equal(true, element.disabled, "element is not disabled");
          assert.equal(true, element.hide, "element is not hidden");

          var label = element.$.label;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "label doesn't have disabled class");

          var cc = element.$.contentContainer;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "contentContainer doesn't have disabled class");

          var atContainer = element.$.atContainer;
          assert.equal(true, Polymer.dom(atContainer).classList.contains('hidden'), "atContainer doesn't have hidden class");
        });

        test('is element valid', function () {
          var element = fixture('isElementValid');
          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element invalid when required', function () {
          var element = fixture('isElementInvalidWhenRequired');
          assert.equal(true, element.required, "element is not required");

          var result = element.validate();
          assert.equal(false, result, "element is valid");
        });

        test('is element valid when required and disabled', function () {
          var element = fixture('isElementValidWhenRequiredAndDisabled');
          assert.equal(true, element.required, "element is not required");
          assert.equal(true, element.disabled, "element is not disabled");

          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element valid when required and hidden', function () {
          var element = fixture('isElementValidWhenRequiredAndHidden');
          assert.equal(true, element.required, "element is not required");
          assert.equal(true, element.hide, "element is not hidden");

          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element valid when required, disabled and hidden', function () {
          var element = fixture('isElementValidWhenRequiredDisabledAndHidden');
          assert.equal(true, element.required, "element is not required");
          assert.equal(true, element.hide, "element is not hidden");
          assert.equal(true, element.disabled, "element is not disabled");

          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element invalid when error message is set', function () {
          var element = fixture('isElementInvalidWhenErrorMessage');
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");

          var result = element.validate();
          assert.equal(false, result, "element is valid");
        });

        test('is element valid when error message is set and disabled', function () {
          var element = fixture('isElementValidWhenErrorMessageAndDisabled');
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");
          assert.equal(true, element.disabled, "element is not disabled");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('is element valid when error message is set and hidden', function () {
          var element = fixture('isElementValidWhenErrorMessageAndHidden');
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");
          assert.equal(true, element.hide, "element is not hidden");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('is element valid when error message is set and disabled and hidden', function () {
          var element = fixture('isElementValidWhenErrorMessageDisabledAndHidden');
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");
          assert.equal(true, element.disabled, "element is not disabled");
          assert.equal(true, element.hide, "element is not hidden");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 0, value empty string', function () {
          var element = fixture('maxChars0EmptyValue');
          assert.equal(0, element.maxChars, "maxChars not set correctly");
          assert.equal("", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 10, value empty string', function () {
          var element = fixture('maxChars10EmptyValue');
          assert.equal(10, element.maxChars, "maxChars not set correctly");
          assert.equal("", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 0, value lorem ipsum', function () {
          var element = fixture('maxChars0ValueLoremIpsum');
          assert.equal(0, element.maxChars, "maxChars not set correctly");
          assert.equal("lorem ipsum", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 10, value lorem ipsum', function () {
          var element = fixture('maxChars10ValueLoremIpsum');
          assert.equal(10, element.maxChars, "maxChars not set correctly");
          assert.equal("lorem ipsum", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(false, result, "element is valid");
        });

        test('is hint displayed', function(done) {
          var codemirror = fixture('isHintDisplayed');

          assert.equal(codemirror.hint, "This is demo hint", 'codemirror.hint property is not set');
          codemirror.focus();

          flush(function() {
            assert.equal(codemirror.$.hint.innerHTML, "This is demo hint", 'codemirror.hint text is incorrect');
            done();
          });
        });
      });

      /********************************************************************************/
      /* PROPERTY TESTS
      /********************************************************************************/

      suite('property values are set in code', function () {

        test('is label displayed', function() {
          var element = fixture('propertyTest');
          element.label = 'lorem ipsum';
          assert.equal(false, element.hideLabel, "hideLabel has incorrect value");

          assert.equal('lorem ipsum', element.label, "element's label not set correctly");
          var label = element.$.label;
          assert.notEqual(null, label, "element's label doesn't exist");
          var displayValue = label.getComputedStyleValue('display');
          assert.equal('block', displayValue, "element's label is not visible");
          assert.equal('lorem ipsum', Polymer.dom(label).innerHTML, "element's label value not set correctly");
        });

        test('is label hidden', function() {
          var element = fixture('propertyTest');
          element.label = 'lorem ipsum';
          element.hideLabel = true;

          assert.equal('lorem ipsum', element.label, "element's label not set correctly");
          assert.equal(true, element.hideLabel, "hideLabel has incorrect value");
          var label = element.$.label;
          assert.notEqual(null, label, "element's label doesn't exist");
          var displayValue = label.getComputedStyleValue('display');
          assert.equal('none', displayValue, "element's label is visible");
          assert.equal('lorem ipsum', Polymer.dom(label).innerHTML, "element's label value not set correctly");
        });

        test('is element disabled', function() {
          var element = fixture('propertyTest');
          element.disabled = true;
          assert.equal(true, element.disabled, "disabled property has incorrect value");

          var label = element.$.label;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "label doesn't have disabled class");

          var cc = element.$.contentContainer;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "contentContainer doesn't have disabled class");
        });

        test('is element hidden', function () {
          var element = fixture('propertyTest');
          element.hide = true;
          assert.equal(true, element.hide, "hide property has incorrect value");

          var atContainer = element.$.atContainer;
          assert.equal(true, Polymer.dom(atContainer).classList.contains('hidden'), "atContainer doesn't have hidden class");
        });

        test('is element disabled and hidden', function () {
          var element = fixture('propertyTest');
          element.disabled = true;
          element.hide = true;
          assert.equal(true, element.disabled, "disabled property has incorrect value");
          assert.equal(true, element.hide, "hide property has incorrect value");

          var label = element.$.label;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "label doesn't have disabled class");

          var cc = element.$.contentContainer;
          assert.equal(true, Polymer.dom(label).classList.contains('disabled'), "contentContainer doesn't have disabled class");

          var atContainer = element.$.atContainer;
          assert.equal(true, Polymer.dom(atContainer).classList.contains('hidden'), "atContainer doesn't have hidden class");
        });

        test('is element valid', function () {
          var element = fixture('propertyTest');
          var isValid = element.validate();
          assert.equal(true, isValid, "element is invalid");
        });

        test('is element invalid when required', function () {
          var element = fixture('propertyTest');
          element.required = true;
          assert.equal(true, element.required, "element is not required");

          var result = element.validate();
          assert.equal(false, result, "element is valid");
        });

        test('is element valid when required and disabled', function () {
          var element = fixture('propertyTest');
          element.required = true;
          element.disabled = true;
          assert.equal(true, element.required, "element is not required");
          assert.equal(true, element.disabled, "element is not disabled");

          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element valid when required and hidden', function () {
          var element = fixture('propertyTest');
          element.required = true;
          element.hide = true;
          assert.equal(true, element.required, "element is not required");
          assert.equal(true, element.hide, "element is not hidden");

          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element valid when required, disabled and hidden', function () {
          var element = fixture('propertyTest');
          element.required = true;
          element.hide = true;
          element.disabled = true;
          assert.equal(true, element.required, "element is not required");
          assert.equal(true, element.hide, "element is not hidden");
          assert.equal(true, element.disabled, "element is not disabled");

          var result = element.validate();
          assert.equal(true, result, "element is not valid");
        });

        test('is element invalid when error message is set', function () {
          var element = fixture('propertyTest');
          element.errorMessage = "lorem ipsum";
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");

          var result = element.validate();
          assert.equal(false, result, "element is valid");
        });

        test('is element valid when error message is set and disabled', function () {
          var element = fixture('propertyTest');
          element.errorMessage = "lorem ipsum";
          element.disabled = true;
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");
          assert.equal(true, element.disabled, "element is not disabled");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('is element valid when error message is set and hidden', function () {
          var element = fixture('propertyTest');
          element.errorMessage = "lorem ipsum";
          element.hide = true;
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");
          assert.equal(true, element.hide, "element is not hidden");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('is element valid when error message is set and disabled and hidden', function () {
          var element = fixture('propertyTest');
          element.errorMessage = "lorem ipsum";
          element.disabled = true;
          element.hide = true;
          assert.equal('lorem ipsum', element.errorMessage, "error message not set correctly");
          assert.equal(true, element.disabled, "element is not disabled");
          assert.equal(true, element.hide, "element is not hidden");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 0, value empty string', function () {
          var element = fixture('propertyTest');
          element.maxChars = 0;
          element.value = "";
          assert.equal(0, element.maxChars, "maxChars not set correctly");
          assert.equal("", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 10, value empty string', function () {
          var element = fixture('propertyTest');
          element.maxChars = 10;
          element.value = "";
          assert.equal(10, element.maxChars, "maxChars not set correctly");
          assert.equal("", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 0, value lorem ipsum', function () {
          var element = fixture('propertyTest');
          element.maxChars = 0;
          element.value = "lorem ipsum";
          assert.equal(0, element.maxChars, "maxChars not set correctly");
          assert.equal("lorem ipsum", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(true, result, "element is invalid");
        });

        test('max chars 10, value lorem ipsum', function () {
          var element = fixture('propertyTest');
          element.maxChars = 10;
          element.value = "lorem ipsum";
          assert.equal(10, element.maxChars, "maxChars not set correctly");
          assert.equal("lorem ipsum", element.value, "value not set correctly");

          var result = element.validate();
          assert.equal(false, result, "element is valid");
        });

        test('is hint displayed', function(done) {
          var element = fixture('propertyTest');
          element.hint = "lorem ipsum";

          assert.equal("lorem ipsum", element.hint, 'hint property is not set correctly');
          element.focus();

          flush(function() {
            assert.equal(element.$.hint.innerHTML, "lorem ipsum", 'codemirror.hint text is incorrect');
            done();
          });
        });
      });

    });
  </script>

</body>

</html>
